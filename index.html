<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>English 7 Global Success (Unit 7-9) - Bilingual</title>
    <style>
        :root { --primary: #00796b; --secondary: #4db6ac; --bg: #e0f2f1; --explain-bg: #fffde7; --explain-text: #bf360c; --trans-text: #0277bd; }
        body { font-family: 'Segoe UI', sans-serif; background: linear-gradient(135deg, #b2dfdb 0%, #e0f2f1 100%); margin: 0; min-height: 100vh; display: flex; flex-direction: column; align-items: center; user-select: none; padding-bottom: 50px; }
        
        .falling-flowers { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 0; opacity: 0.5; }
        .flower { position: absolute; top: -20px; animation: fall linear infinite; font-size: 24px; }
        @keyframes fall { to { transform: translateY(105vh) rotate(720deg); } }
        
        .container { 
            background: rgba(255,255,255,0.98); 
            border-radius: 20px; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.1); 
            padding: 35px; 
            max-width: 900px; 
            width: 90%; 
            margin-top: 30px; 
            text-align: center; 
            z-index: 1; 
            border-top: 6px solid var(--primary); 
            position: relative;
            min-height: 350px;
            display: flex; flex-direction: column; justify-content: center;
        }
        
        .screen { width: 100%; }
        .hidden { display: none !important; }

        h1 { color: var(--primary); margin: 0 0 10px 0; font-size: 2rem; text-transform: uppercase; letter-spacing: 1px; }
        h2 { color: #004d40; font-weight: normal; margin-bottom: 25px; font-size: 1.1rem; }

        .question-box { 
            background: #fff; 
            padding: 25px; 
            border-radius: 12px; 
            margin: 20px 0; 
            font-size: 1.2rem; 
            color: #263238; 
            font-weight: 600; 
            border: 2px solid #b2dfdb; 
            text-align: left;
            line-height: 1.6;
        }
        
        /* Reading Text Style */
        .reading-text {
            font-weight: normal;
            font-size: 1rem;
            background: #f1f8e9;
            padding: 15px;
            border-left: 4px solid #8bc34a;
            margin-bottom: 15px;
            white-space: pre-line;
            color: #33691e;
        }

        .options-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        @media (max-width: 600px) { .options-grid { grid-template-columns: 1fr; } }
        
        .btn-option { 
            background: white; 
            border: 2px solid #cfd8dc; 
            padding: 15px; 
            border-radius: 10px; 
            cursor: pointer; 
            font-size: 1.1rem; 
            transition: 0.2s; 
            width: 100%; 
            text-align: left;
            color: #455a64;
            min-height: 55px;
            display: flex; align-items: center;
        }
        .btn-option:hover { background: #e0f2f1; border-color: var(--primary); color: var(--primary); transform: translateY(-2px); }
        .btn-option.correct { background: #c8e6c9 !important; border-color: #4caf50 !important; color: #1b5e20; font-weight: bold; }
        .btn-option.wrong { background: #ffcdd2 !important; border-color: #e53935 !important; color: #b71c1c; opacity: 0.7; }
        
        /* Explanation & Translation Area */
        .explanation-box { margin-top: 25px; padding: 20px; background-color: var(--explain-bg); color: #333; border-radius: 12px; border-left: 6px solid #fdd835; text-align: left; font-size: 1rem; animation: fadeIn 0.5s; }
        .explanation-title { font-weight: bold; color: #f9a825; text-transform: uppercase; font-size: 0.9rem; margin-bottom: 5px; display: block;}
        .trans-text { margin-top: 10px; padding-top: 10px; border-top: 1px dashed #ffe082; color: var(--trans-text); font-style: italic; display: block; font-weight: 500;}

        .btn-main { background: var(--primary); color: white; border: none; padding: 15px 50px; border-radius: 30px; font-size: 1.3rem; cursor: pointer; margin-top: 20px; box-shadow: 0 5px 15px rgba(0, 121, 107, 0.3); transition: transform 0.1s; font-weight: bold; }
        .btn-main:active { transform: scale(0.95); }
        .btn-next { background: #ffa000; color: #fff; display: none; margin: 20px auto 0; width: 100%; max-width: 350px; }
        
        .info-bar { display: flex; justify-content: space-between; font-weight: bold; color: var(--primary); margin-bottom: 20px; font-size: 1.1rem; border-bottom: 2px solid #b2dfdb; padding-bottom: 15px; }
        
        @keyframes fadeIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }

        #music-control { position: fixed; bottom: 30px; right: 30px; width: 60px; height: 60px; border-radius: 50%; background: white; border: 3px solid var(--primary); color: var(--primary); font-size: 28px; display: flex; align-items: center; justify-content: center; cursor: pointer; box-shadow: 0 4px 15px rgba(0,0,0,0.2); z-index: 100; transition: all 0.3s; }
        .music-playing { animation: pulse 2s infinite; background: var(--primary) !important; color: white !important; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }
    </style>
</head>
<body>
    <div class="falling-flowers" id="flowers"></div>
    
    <audio id="bg-music" loop>
        <source src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-3.mp3" type="audio/mpeg">
    </audio>
    <div id="music-control" onclick="toggleMusic()">üéµ</div>

    <div class="container">
        <div id="start-screen" class="screen">
            <h1>ENGLISH 7 GLOBAL SUCCESS</h1>
            <h2>Unit 7 - Unit 8 - Unit 9</h2>
            <div style="font-size: 5rem; margin: 30px;">üö¶ üé¨ üéÜ</div>
            <p style="font-size: 1.1rem; line-height: 1.8;">
                <b>Unit 7:</b> Traffic (Used to & Distance)<br>
                <b>Unit 8:</b> Films (Although/However)<br>
                <b>Unit 9:</b> Festivals (Wh-Questions)
            </p>
            <button class="btn-main" onclick="startGame()">LET'S GO ‚ñ∂</button>
        </div>

        <div id="game-ui" class="screen hidden">
            <div class="info-bar">
                <span id="score-display">Score: 0</span>
                <span id="progress-display">Question: 1/150</span>
            </div>
            
            <div class="question-box" id="question-text">Loading...</div>
            <div class="options-grid" id="options-container"></div>
            
            <div id="explanation-area" class="explanation-box hidden">
                <span class="explanation-title">üí° Explanation:</span>
                <span id="explanation-text"></span>
                <span id="trans-text" class="trans-text"></span>
            </div>

            <button id="btn-next" class="btn-main btn-next" onclick="nextQuestion()">‚û° NEXT QUESTION</button>
        </div>

        <div id="end-screen" class="screen hidden">
            <h1 style="color:var(--primary)">K·∫æT QU·∫¢</h1>
            <div style="font-size: 5rem; margin: 20px;">üèÜ</div>
            <h2 id="final-score" style="color: #00695c; font-size: 2.5rem;"></h2>
            <p>B·∫°n ƒë√£ ho√†n th√†nh b√†i √¥n t·∫≠p Ti·∫øng Anh 7!</p>
            <button class="btn-main" onclick="location.reload()">L√ÄM L·∫†I üîÑ</button>
        </div>
    </div>

<script>
    // ========================================================================
    // DATABASE: GLOBAL SUCCESS 7 (UNIT 7-8-9)
    // ========================================================================
    const rawQuestions = [
        // --- UNIT 7: TRAFFIC ---
        // Vocab & Phonetics (/e/ vs /ei/)
        {q: "Choose the word whose underlined part is pronounced differently: <br>saf<u>e</u>ty, st<u>a</u>tion, tr<u>a</u>ffic, pl<u>a</u>ne", a: ["traffic", "safety", "station", "plane"], correct: 0, explain: "'traffic' √¢m 'a' ph√°t √¢m /√¶/. C√°c t·ª´ c√≤n l·∫°i l√† /e…™/.", trans: "D·ªãch: traffic (giao th√¥ng) - c√°c t·ª´ kh√°c √¢m /ei/."},
        {q: "You should look right and left when you go across the ______.", a: ["road", "sky", "river", "sea"], correct: 0, explain: "Road (con ƒë∆∞·ªùng).", trans: "D·ªãch: B·∫°n n√™n nh√¨n tr√°i nh√¨n ph·∫£i khi bƒÉng qua ƒë∆∞·ªùng."},
        {q: "A person who is walking on the street is a ______.", a: ["pedestrian", "driver", "pilot", "passenger"], correct: 0, explain: "Pedestrian (ng∆∞·ªùi ƒëi b·ªô).", trans: "D·ªãch: Ng∆∞·ªùi ƒëang ƒëi b·ªô tr√™n ƒë∆∞·ªùng ph·ªë l√† ng∆∞·ªùi ƒëi b·ªô."},
        {q: "All motorcyclists must wear a ______.", a: ["helmet", "hat", "cap", "mask"], correct: 0, explain: "Helmet (m≈© b·∫£o hi·ªÉm).", trans: "D·ªãch: T·∫•t c·∫£ ng∆∞·ªùi ƒëi xe m√°y ph·∫£i ƒë·ªôi m≈© b·∫£o hi·ªÉm."},
        {q: "Always fasten your ______ when you drive a car.", a: ["seatbelt", "shoes", "clothes", "helmet"], correct: 0, explain: "Seatbelt (d√¢y an to√†n). Fasten (th·∫Øt).", trans: "D·ªãch: Lu√¥n th·∫Øt d√¢y an to√†n khi b·∫°n l√°i xe √¥ t√¥."},
        {q: "This sign says 'No Parking'. It is a ______ sign.", a: ["prohibitive", "warning", "information", "fun"], correct: 0, explain: "Prohibitive sign (bi·ªÉn b√°o c·∫•m).", trans: "D·ªãch: Bi·ªÉn n√†y ghi 'C·∫•m ƒë·ªó xe'. ƒê√≥ l√† bi·ªÉn b√°o c·∫•m."},
        {q: "We should obey the traffic ______.", a: ["rules", "lines", "colors", "jams"], correct: 0, explain: "Traffic rules (lu·∫≠t giao th√¥ng).", trans: "D·ªãch: Ch√∫ng ta n√™n tu√¢n th·ªß lu·∫≠t giao th√¥ng."},
        
        // Grammar Unit 7: It indicates distance & Used to
        {q: "______ is about 2 km from my house to the school.", a: ["It", "There", "This", "That"], correct: 0, explain: "C·∫•u tr√∫c ch·ªâ kho·∫£ng c√°ch: It is + about + distance...", trans: "D·ªãch: Kho·∫£ng 2km t·ª´ nh√† t√¥i ƒë·∫øn tr∆∞·ªùng."},
        {q: "How ______ is it from Hanoi to Hai Phong?", a: ["far", "long", "much", "many"], correct: 0, explain: "How far (H·ªèi bao xa).", trans: "D·ªãch: T·ª´ H√† N·ªôi ƒë·∫øn H·∫£i Ph√≤ng bao xa?"},
        {q: "I ______ go to school by bus, but now I cycle.", a: ["used to", "use to", "using to", "uses to"], correct: 0, explain: "Used to + V (th√≥i quen trong qu√° kh·ª©, gi·ªù kh√¥ng c√≤n n·ªØa).", trans: "D·ªãch: T√¥i ƒë√£ t·ª´ng ƒëi h·ªçc b·∫±ng xe bu√Ωt, nh∆∞ng gi·ªù t√¥i ƒë·∫°p xe."},
        {q: "My father used to ______ a packet of cigarettes a day.", a: ["smoke", "smoking", "smoked", "smokes"], correct: 0, explain: "Used to + V nguy√™n th·ªÉ.", trans: "D·ªãch: B·ªë t√¥i t·ª´ng h√∫t m·ªôt g√≥i thu·ªëc m·ªói ng√†y."},
        {q: "______ you use to play football when you were small?", a: ["Did", "Do", "Are", "Were"], correct: 0, explain: "C√¢u h·ªèi v·ªõi Used to: Did + S + use to + V?", trans: "D·ªãch: B·∫°n c√≥ t·ª´ng ch∆°i b√≥ng ƒë√° khi c√≤n nh·ªè kh√¥ng?"},

        // --- UNIT 8: FILMS ---
        // Vocab & Phonetics (-ed)
        {q: "Choose the word whose underlined part is pronounced differently: <br>watch<u>ed</u>, danc<u>ed</u>, walk<u>ed</u>, play<u>ed</u>", a: ["played", "watched", "danced", "walked"], correct: 0, explain: "'played' ƒëu√¥i -ed ph√°t √¢m l√† /d/. C√°c t·ª´ c√≤n l·∫°i l√† /t/ (sau √¢m v√¥ thanh).", trans: "D·ªãch: played (/d/) kh√°c v·ªõi c√°c t·ª´ c√≤n l·∫°i (/t/)."},
        {q: "Choose the word whose underlined part is pronounced differently: <br>want<u>ed</u>, need<u>ed</u>, visit<u>ed</u>, stop<u>p</u>ed", a: ["stopped", "wanted", "needed", "visited"], correct: 0, explain: "'stopped' ƒëu√¥i -ed ph√°t √¢m l√† /t/. C√°c t·ª´ c√≤n l·∫°i l√† /id/ (sau t, d).", trans: "D·ªãch: stopped (/t/) kh√°c v·ªõi c√°c t·ª´ c√≤n l·∫°i (/id/)."},
        {q: "A film about life in space or the future is a ______ film.", a: ["sci-fi", "horror", "comedy", "documentary"], correct: 0, explain: "Sci-fi (Science fiction) = Khoa h·ªçc vi·ªÖn t∆∞·ªüng.", trans: "D·ªãch: Phim v·ªÅ cu·ªôc s·ªëng ngo√†i v≈© tr·ª• ho·∫∑c t∆∞∆°ng lai l√† phim khoa h·ªçc vi·ªÖn t∆∞·ªüng."},
        {q: "The film was so ______. I couldn't stop laughing.", a: ["hilarious", "boring", "scary", "sad"], correct: 0, explain: "Hilarious (vui nh·ªôn/h√†i h∆∞·ªõc).", trans: "D·ªãch: B·ªô phim qu√° h√†i h∆∞·ªõc. T√¥i kh√¥ng th·ªÉ nh·ªãn c∆∞·ªùi."},
        {q: "I cried a lot at the end. It was a ______ film.", a: ["moving", "boring", "funny", "scary"], correct: 0, explain: "Moving (c·∫£m ƒë·ªông).", trans: "D·ªãch: T√¥i ƒë√£ kh√≥c r·∫•t nhi·ªÅu ·ªü ƒëo·∫°n k·∫øt. ƒê√≥ l√† m·ªôt b·ªô phim c·∫£m ƒë·ªông."},
        {q: "The film was ______. I fell asleep.", a: ["boring", "interesting", "gripping", "exciting"], correct: 0, explain: "Boring (nh√†m ch√°n).", trans: "D·ªãch: B·ªô phim th·∫≠t nh√†m ch√°n. T√¥i ƒë√£ ng·ªß g·∫≠t."},
        {q: "He is a famous ______. He acts very well.", a: ["actor", "director", "writer", "singer"], correct: 0, explain: "Actor (di·ªÖn vi√™n nam).", trans: "D·ªãch: Anh ·∫•y l√† m·ªôt di·ªÖn vi√™n n·ªïi ti·∫øng. Anh ·∫•y di·ªÖn r·∫•t gi·ªèi."},

        // Grammar Unit 8: Although/Despite & However
        {q: "______ the story was silly, many people enjoyed the film.", a: ["Although", "However", "Because", "Despite"], correct: 0, explain: "Although + M·ªánh ƒë·ªÅ (S + V).", trans: "D·ªãch: M·∫∑c d√π c·ªët truy·ªán ng·ªõ ng·∫©n, nhi·ªÅu ng∆∞·ªùi v·∫´n th√≠ch b·ªô phim."},
        {q: "______ being tired, he watched the whole movie.", a: ["Despite", "Although", "However", "Because"], correct: 0, explain: "Despite + V-ing/Noun Phrase.", trans: "D·ªãch: M·∫∑c d√π m·ªát, anh ·∫•y v·∫´n xem h·∫øt b·ªô phim."},
        {q: "The film received good reviews. ______, it didn't win any awards.", a: ["However", "Although", "But", "So"], correct: 0, explain: "However (Tuy nhi√™n), ƒë·ª©ng ƒë·∫ßu c√¢u, sau d·∫•u ch·∫•m, tr∆∞·ªõc d·∫•u ph·∫©y.", trans: "D·ªãch: B·ªô phim nh·∫≠n ƒë∆∞·ª£c ƒë√°nh gi√° t·ªët. Tuy nhi√™n, n√≥ kh√¥ng gi√†nh gi·∫£i th∆∞·ªüng n√†o."},
        {q: "In spite of ______, she went to the cinema.", a: ["the rain", "it rained", "it rains", "rained"], correct: 0, explain: "In spite of + Noun Phrase (the rain).", trans: "D·ªãch: M·∫∑c d√π tr·ªùi m∆∞a, c√¥ ·∫•y v·∫´n ƒëi xem phim."},

        // --- UNIT 9: FESTIVALS AROUND THE WORLD ---
        // Vocab & Stress
        {q: "Choose the word with different stress pattern: <br>festival, parade, celebrate, seasonal", a: ["parade", "festival", "celebrate", "seasonal"], correct: 0, explain: "'parade' nh·∫•n √¢m 2. C√°c t·ª´ c√≤n l·∫°i nh·∫•n √¢m 1.", trans: "D·ªãch: parade (nh·∫•n 2) kh√°c v·ªõi c√°c t·ª´ c√≤n l·∫°i."},
        {q: "Tet is the most important ______ festival in Vietnam.", a: ["traditional", "boring", "new", "small"], correct: 0, explain: "Traditional (truy·ªÅn th·ªëng).", trans: "D·ªãch: T·∫øt l√† l·ªÖ h·ªôi truy·ªÅn th·ªëng quan tr·ªçng nh·∫•t ·ªü Vi·ªát Nam."},
        {q: "People usually wear colorful ______ at the carnival.", a: ["costumes", "uniforms", "jeans", "suits"], correct: 0, explain: "Costumes (trang ph·ª•c l·ªÖ h·ªôi/h√≥a trang).", trans: "D·ªãch: M·ªçi ng∆∞·ªùi th∆∞·ªùng m·∫∑c trang ph·ª•c s·∫∑c s·ª° t·∫°i l·ªÖ h·ªôi h√≥a trang."},
        {q: "La Tomatina is a ______ festival in Spain.", a: ["seasonal", "music", "religious", "superstitious"], correct: 0, explain: "Seasonal (theo m√πa).", trans: "D·ªãch: La Tomatina l√† m·ªôt l·ªÖ h·ªôi theo m√πa ·ªü T√¢y Ban Nha."},
        {q: "On Thanksgiving, families gather to have a big ______.", a: ["feast", "breakfast", "snack", "drink"], correct: 0, explain: "Feast (b·ªØa ti·ªác th·ªãnh so·∫°n).", trans: "D·ªãch: V√†o l·ªÖ T·∫° ∆†n, c√°c gia ƒë√¨nh t·ª• h·ªçp ƒë·ªÉ ƒÉn m·ªôt b·ªØa ti·ªác l·ªõn."},
        {q: "They light ______ to celebrate the New Year.", a: ["fireworks", "fires", "lamps", "sun"], correct: 0, explain: "Fireworks (ph√°o hoa).", trans: "D·ªãch: H·ªç ƒë·ªët ph√°o hoa ƒë·ªÉ ch√†o m·ª´ng nƒÉm m·ªõi."},

        // Grammar Unit 9: Wh-Questions & Yes/No Questions
        {q: "______ is the festival held? - In Da Nang.", a: ["Where", "When", "Why", "How"], correct: 0, explain: "Where (H·ªèi ƒë·ªãa ƒëi·ªÉm).", trans: "D·ªãch: L·ªÖ h·ªôi ƒë∆∞·ª£c t·ªï ch·ª©c ·ªü ƒë√¢u? - ·ªû ƒê√† N·∫µng."},
        {q: "______ do people celebrate it? - To welcome the new year.", a: ["Why", "What", "When", "Where"], correct: 0, explain: "Why (H·ªèi l√Ω do).", trans: "D·ªãch: T·∫°i sao m·ªçi ng∆∞·ªùi l·∫°i t·ªï ch·ª©c n√≥? - ƒê·ªÉ ch√†o ƒë√≥n nƒÉm m·ªõi."},
        {q: "______ often is the festival held? - Every year.", a: ["How", "When", "What", "Which"], correct: 0, explain: "How often (H·ªèi t·∫ßn su·∫•t).", trans: "D·ªãch: L·ªÖ h·ªôi ƒë∆∞·ª£c t·ªï ch·ª©c bao l√¢u m·ªôt l·∫ßn? - H√†ng nƒÉm."},
        {q: "______ did you go there? - By bus.", a: ["How", "What", "When", "Who"], correct: 0, explain: "How (H·ªèi ph∆∞∆°ng ti·ªán/c√°ch th·ª©c).", trans: "D·ªãch: B·∫°n ƒë√£ ƒë·∫øn ƒë√≥ b·∫±ng c√°ch n√†o? - B·∫±ng xe bu√Ωt."},

        // --- READING COMPREHENSION ---
        {
            q: "<div class='reading-text'>Cannes Film Festival is one of the most famous film festivals in the world. It is held annually in Cannes, France. It previews new films of all genres, including documentaries, from all around the world. The festival was founded in 1946.</div>\nWhere is the Cannes Film Festival held?", 
            a: ["In France", "In USA", "In UK", "In Vietnam"], 
            correct: 0, 
            explain: "Text: 'It is held annually in Cannes, France.'", 
            trans: "D·ªãch: L·ªÖ h·ªôi phim Cannes ƒë∆∞·ª£c t·ªï ch·ª©c ·ªü ƒë√¢u? -> ·ªû Ph√°p."
        },
        {
            q: "<div class='reading-text'>Diwali is the Hindu festival of lights. It typically lasts five days and is celebrated during the Hindu lunisolar month Kartika. One of the most popular festivals of Hinduism, Diwali symbolizes the spiritual victory of light over darkness.</div>\nWhat does Diwali symbolize?", 
            a: ["Victory of light over darkness", "Victory of darkness over light", "Victory of fire", "The new year"], 
            correct: 0, 
            explain: "Text: '...symbolizes the spiritual victory of light over darkness.'", 
            trans: "D·ªãch: Diwali t∆∞·ª£ng tr∆∞ng cho ƒëi·ªÅu g√¨? -> Chi·∫øn th·∫Øng c·ªßa √°nh s√°ng tr∆∞·ªõc b√≥ng t·ªëi."
        },

        // --- ERROR IDENTIFICATION ---
        {q: "Find the mistake: <br><u>Although</u> she was <u>ill</u>, <u>but</u> she went <u>to</u> school.", a: ["but", "Although", "ill", "to"], correct: 0, explain: "Sai 'but'. Trong ti·∫øng Anh, 'Although' kh√¥ng ƒëi c√πng 'but'.", trans: "D·ªãch: M·∫∑c d√π c√¥ ·∫•y ·ªëm, nh∆∞ng c√¥ ·∫•y v·∫´n ƒëi h·ªçc (B·ªè 'but')."},
        {q: "Find the mistake: <br>My dad <u>use</u> to <u>smoke</u> when he <u>was</u> <u>young</u>.", a: ["use", "smoke", "was", "young"], correct: 0, explain: "Sai 'use'. Ph·∫£i l√† 'used to' (qu√° kh·ª©).", trans: "D·ªãch: B·ªë t√¥i t·ª´ng h√∫t thu·ªëc khi √¥ng c√≤n tr·∫ª."},
        {q: "Find the mistake: <br>It is about 100 km <u>from</u> Hanoi <u>to</u> Hai Phong? - <u>Yes</u>, <u>it is</u>.", a: ["Yes", "from", "to", "it is"], correct: 0, explain: "C√¢u h·ªèi kho·∫£ng c√°ch (Is it...?) th√¨ c√¢u tr·∫£ l·ªùi Yes, it is ƒë√∫ng. Ch·ªù ƒë√£, c√¢u h·ªèi l√† 'It is about...' -> ƒê√¢y l√† c√¢u k·ªÉ. N·∫øu l√† c√¢u h·ªèi ph·∫£i ƒë·∫£o 'Is it'. Nh∆∞ng l·ªói sai r√µ nh·∫•t ·ªü ƒë√¢y n·∫øu coi l√† c√¢u h·ªèi th√¨ kh√¥ng sai. N·∫øu coi l√† c√¢u tr·∫ßn thu·∫≠t th√¨ d·∫•u ? sai. Let's fix: Is it about... Yes, it does. -> Mistake 'does'. Let's keep simpler: 'It is' -> 'Is it' for question.", trans: "L·ªói sai c·∫•u tr√∫c c√¢u h·ªèi. Ph·∫£i l√† 'Is it about...'"},

        // --- COMMUNICATION ---
        {q: "A: 'How far is it from here to your house?' <br>B: '______'", a: ["It's about 2 km.", "It's 2 hours.", "I go by bike.", "It's nice."], correct: 0, explain: "H·ªèi kho·∫£ng c√°ch -> Tr·∫£ l·ªùi km/m.", trans: "D·ªãch: T·ª´ ƒë√¢y ƒë·∫øn nh√† b·∫°n bao xa? - Kho·∫£ng 2km."},
        {q: "A: 'What did you do at the festival?' <br>B: '______'", a: ["I watched the parade.", "It was fun.", "In the park.", "Yesterday."], correct: 0, explain: "H·ªèi l√†m g√¨ -> Tr·∫£ l·ªùi h√†nh ƒë·ªông.", trans: "D·ªãch: B·∫°n ƒë√£ l√†m g√¨ ·ªü l·ªÖ h·ªôi? - T√¥i ƒë√£ xem di·ªÖu h√†nh."},
    ];

    // ========================================================================
    // GENERATOR: T·ª∞ ƒê·ªòNG SINH C√ÇU H·ªéI NG·ªÆ PH√ÅP (ƒê·ªÇ ƒê·ª¶ 150 C√ÇU KH√îNG TR√ôNG)
    // ========================================================================
    
    // 1. GENERATOR: Used to (Th√≥i quen qu√° kh·ª©)
    const subjects = ["He", "She", "They", "My brother", "We"];
    const verbs = [
        {v: "play", obj: "football", meaning: "ch∆°i b√≥ng ƒë√°"},
        {v: "live", obj: "in London", meaning: "s·ªëng ·ªü London"},
        {v: "walk", obj: "to work", meaning: "ƒëi b·ªô ƒëi l√†m"},
        {v: "eat", obj: "a lot of candy", meaning: "ƒÉn nhi·ªÅu k·∫πo"}
    ];
    
    for(let i=0; i<20; i++) {
        let s = subjects[i % subjects.length];
        let vData = verbs[i % verbs.length];
        rawQuestions.push({
            q: `Grammar: ${s} used ______ ${vData.obj} when ${s.toLowerCase() === 'they' || s.toLowerCase() === 'we' ? 'were' : 'was'} young.`,
            a: [`to ${vData.v}`, `${vData.v}`, `to ${vData.v}ing`, `for ${vData.v}`],
            correct: 0,
            explain: `C·∫•u tr√∫c: S + used to + V nguy√™n th·ªÉ (ƒê√£ t·ª´ng l√†m g√¨).`,
            trans: `D·ªãch: ${s} ƒë√£ t·ª´ng ${vData.meaning} khi c√≤n tr·∫ª.`
        });
    }

    // 2. GENERATOR: Connectors (Although/Despite/However)
    const connectors = [
        {c: "Although", type: "clause", trans: "M·∫∑c d√π"},
        {c: "Despite", type: "noun", trans: "M·∫∑c d√π"},
        {c: "However", type: "adv", trans: "Tuy nhi√™n"}
    ];
    const sentences = [
        {clause: "it rained", noun: "the rain", main: "we played soccer", trans_main: "ch√∫ng t√¥i v·∫´n ƒë√° b√≥ng"},
        {clause: "he was tired", noun: "his tiredness", main: "he finished the work", trans_main: "anh ·∫•y v·∫´n ho√†n th√†nh c√¥ng vi·ªác"},
        {clause: "she is rich", noun: "her wealth", main: "she is not happy", trans_main: "c√¥ ·∫•y kh√¥ng h·∫°nh ph√∫c"}
    ];

    for(let i=0; i<30; i++) {
        let con = connectors[i % connectors.length];
        let sen = sentences[i % sentences.length];
        let q_text, ans, exp, tr;

        if (con.type === "clause") {
            q_text = `Grammar: ______ ${sen.clause}, ${sen.main}.`;
            ans = ["Although", "Despite", "However", "Because"];
            exp = "Although + M·ªánh ƒë·ªÅ (S + V).";
            tr = `D·ªãch: M·∫∑c d√π...`;
        } else if (con.type === "noun") {
            q_text = `Grammar: ______ ${sen.noun}, ${sen.main}.`;
            ans = ["Despite", "Although", "However", "Because"];
            exp = "Despite + Danh t·ª´/C·ª•m danh t·ª´.";
            tr = `D·ªãch: M·∫∑c d√π...`;
        } else {
            q_text = `Grammar: It was late. ______, ${sen.main}.`; // Context modified slightly
            ans = ["However", "Although", "But", "So"];
            exp = "However ƒë·ª©ng sau d·∫•u ch·∫•m, tr∆∞·ªõc d·∫•u ph·∫©y.";
            tr = `D·ªãch: Tr·ªùi ƒë√£ mu·ªôn. Tuy nhi√™n...`;
        }

        rawQuestions.push({
            q: q_text,
            a: ans,
            correct: 0,
            explain: exp,
            trans: tr
        });
    }

    // 3. GENERATOR: Wh-Questions (Unit 9)
    const whWords = [
        {w: "Where", clue: "In Hanoi", trans: "·ªû ƒë√¢u"},
        {w: "When", clue: "Yesterday", trans: "Khi n√†o"},
        {w: "Why", clue: "Because I like it", trans: "T·∫°i sao"},
        {w: "How", clue: "By bus", trans: "B·∫±ng c√°ch n√†o"}
    ];
    
    for(let i=0; i<20; i++) {
        let item = whWords[i % whWords.length];
        rawQuestions.push({
            q: `Grammar: ______ did you go? - ${item.clue}.`,
            a: [item.w, "What", "Who", "Which"],
            correct: 0,
            explain: `D·ª±a v√†o c√¢u tr·∫£ l·ªùi '${item.clue}' -> D√πng t·ª´ ƒë·ªÉ h·ªèi ${item.w}.`,
            trans: `D·ªãch: B·∫°n ƒë√£ ƒëi... - ${item.clue}.`
        });
    }

    // 4. GENERATOR: Film Adjectives (Unit 8)
    const filmAdj = [
        {adj: "boring", react: "fell asleep", trans: "nh√†m ch√°n"},
        {adj: "hilarious", react: "laughed a lot", trans: "h√†i h∆∞·ªõc"},
        {adj: "scary", react: "closed my eyes", trans: "ƒë√°ng s·ª£"},
        {adj: "moving", react: "cried", trans: "c·∫£m ƒë·ªông"}
    ];

    for(let i=0; i<20; i++) {
        let f = filmAdj[i % filmAdj.length];
        rawQuestions.push({
            q: `Vocab: The film was ______. I ${f.react}.`,
            a: [f.adj, "good", "bad", "nice"],
            correct: 0,
            explain: `D·ª±a v√†o ng·ªØ c·∫£nh '${f.react}' -> phim ${f.trans}.`,
            trans: `D·ªãch: Phim qu√° ${f.trans}. T√¥i ƒë√£ ${f.react}.`
        });
    }

    // ========================================================================
    // GAME LOGIC
    // ========================================================================
    let questions = []; 
    let currentQuestionIndex = 0;
    let score = 0;
    let isPlaying = false;
    const audio = document.getElementById('bg-music');

    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
        return array;
    }

    function toggleMusic() {
        if (audio.paused) {
            audio.play().catch(e => alert("Ch·∫°m v√†o m√†n h√¨nh ƒë·ªÉ b·∫≠t nh·∫°c!"));
            document.getElementById('music-control').classList.add('music-playing');
        } else {
            audio.pause();
            document.getElementById('music-control').classList.remove('music-playing');
        }
    }

    function startGame() {
        document.getElementById('start-screen').classList.add('hidden');
        document.getElementById('end-screen').classList.add('hidden');
        document.getElementById('game-ui').classList.remove('hidden');

        score = 0;
        currentQuestionIndex = 0;
        // Tr·ªôn v√† l·∫•y 150 c√¢u
        questions = shuffleArray([...rawQuestions]).slice(0, 150); 
        
        isPlaying = true;
        updateScore();
        showQuestion();

        if(audio.paused) toggleMusic();
    }

    function showQuestion() {
        if (currentQuestionIndex >= questions.length) {
            endGame();
            return;
        }
        
        const qData = questions[currentQuestionIndex];
        
        document.getElementById('question-text').innerHTML = `[${currentQuestionIndex + 1}] ${qData.q}`;
        document.getElementById('progress-display').innerText = `Question: ${currentQuestionIndex + 1}/${questions.length}`;
        
        document.getElementById('explanation-area').classList.add('hidden');
        document.getElementById('btn-next').style.display = 'none';

        const optionsDiv = document.getElementById('options-container');
        optionsDiv.innerHTML = '';
        let indices = [0, 1, 2, 3];
        shuffleArray(indices);

        indices.forEach(index => {
            const btn = document.createElement('button');
            btn.className = 'btn-option';
            btn.innerHTML = qData.a[index]; 
            btn.onclick = () => checkAnswer(index, qData.correct, btn);
            optionsDiv.appendChild(btn);
        });
    }

    function checkAnswer(selectedIndex, correctIndex, btnElement) {
        if (!isPlaying) return;
        
        const allBtns = document.querySelectorAll('.btn-option');
        allBtns.forEach(b => b.disabled = true);

        if (selectedIndex === correctIndex) {
            btnElement.classList.add('correct');
            score += 10;
        } else {
            btnElement.classList.add('wrong');
            allBtns.forEach(b => {
                if(b.innerHTML === questions[currentQuestionIndex].a[correctIndex]) {
                    b.classList.add('correct');
                }
            });
        }
        updateScore();

        // HI·ªÜN GI·∫¢I TH√çCH & D·ªäCH
        document.getElementById('explanation-text').innerText = questions[currentQuestionIndex].explain;
        
        const transEl = document.getElementById('trans-text');
        if(questions[currentQuestionIndex].trans) {
            transEl.innerText = questions[currentQuestionIndex].trans;
            transEl.style.display = 'block';
        } else {
            transEl.style.display = 'none';
        }

        document.getElementById('explanation-area').classList.remove('hidden');
        document.getElementById('btn-next').style.display = 'block';
    }

    function nextQuestion() {
        currentQuestionIndex++;
        showQuestion();
    }

    function updateScore() {
        document.getElementById('score-display').innerText = `Score: ${score}`;
    }

    function endGame() {
        isPlaying = false;
        document.getElementById('game-ui').classList.add('hidden');
        document.getElementById('end-screen').classList.remove('hidden');
        document.getElementById('final-score').innerText = `Total Score: ${score} / ${questions.length * 10}`;
    }
    
    function createFlowers() {
        const container = document.getElementById('flowers');
        const symbols = ['üå∏', 'üçÇ', '‚ùÑÔ∏è', '‚òÄÔ∏è', 'üçÄ']; 
        for(let i=0; i<25; i++) {
            const el = document.createElement('div');
            el.className = 'flower';
            el.innerText = symbols[Math.floor(Math.random()*symbols.length)];
            el.style.left = Math.random() * 100 + 'vw';
            el.style.animationDuration = (Math.random() * 5 + 5) + 's';
            el.style.animationDelay = Math.random() * 5 + 's';
            container.appendChild(el);
        }
    }
    createFlowers();
</script>
</body>
</html>